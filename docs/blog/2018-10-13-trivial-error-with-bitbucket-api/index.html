<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>Trivial error with Bitbucket API | Gonzalo&#39;s thoughts</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Trivial error with Bitbucket API" />
  <meta name="twitter:description" content=""/>
  <meta name="twitter:site" content="@gonfva" />
  <meta name="twitter:creator" content="https://twitter.com/gonfva" />
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />


  
  
    
 
  
  
  
  
  
  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.b60e0932fe1c50c3d7c5b4f83ee9e4592363654d0f2abf05bbd0678d5b8a214c.css" integrity="sha256-tg4JMv4cUMPXxbT4PunkWSNjZU0PKr8Fu9BnjVuKIUw="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.13f3d286ba048c28b237e8d7deab0cfd65a32d909d9ddb7038054a6007eafaf2.css" integrity="sha256-E/PShroEjCiyN&#43;jX3qsM/WWjLZCdndtwOAVKYAfq&#43;vI="/>
  
  
   
   
    

<script type="application/ld+json">
  
    {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/gonzalo.f-v.es\/"
      },
      "articleSection" : "blog",
      "name" : "Trivial error with Bitbucket API",
      "headline" : "Trivial error with Bitbucket API",
      "description" : "",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2018",
      "datePublished": "2018-10-13 18:00:00 \u002b0000 UTC",
      "dateModified" : "2018-10-13 18:00:00 \u002b0000 UTC",
      "url" : "http:\/\/gonzalo.f-v.es\/blog\/2018-10-13-trivial-error-with-bitbucket-api\/",
      "wordCount" : "494",
      "keywords" : ["Blog"]
    }
  
  </script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">About</a>
      </li>
    
      <li>
        <a  href="/blog">Blog EN</a>
      </li>
    
      <li>
        <a  href="/es/blog">Blog ES</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">Trivial error with Bitbucket API</h1>
            
            <h2>Migrating to cloud Bitbucket</h2>
            
            <time datetime="2018-10-13 18:00:00 &#43;0000 UTC" class="post__date">2018-10-13</time> 
          </header>
          <article class="post__content">
              
<p><strong>UPDATE</strong>: A few days after publication, <a href="https://developer.atlassian.com/bitbucket/api/2/reference/resource/repositories/%7Busername%7D/%7Brepo_slug%7D/pullrequests#post" 
  
   target="_blank" rel="noreferrer noopener" 
>the documentation now includes</a>
 some examples. Well done, Atlassian.</p>
<p>Most people in the software industry know <a href="https://www.atlassian.com/software/jira?" 
  
   target="_blank" rel="noreferrer noopener" 
>Jira</a>
. For better or for worse, it’s the most used product for managing tickets, requests, bugs…</p>
<p>The company behind that product, Atlassian, has other products. One of them is called Bitbucket, and, similar to Github, it is a Source Code management system. My personal opinion is that Bitbucket is cheaper, but also that Github is better.</p>
<p>Anyway, in our company we have an old version of Bitbucket hosted on premises. And, even if we take backups and test them, we’ve considered moving to the cloud version. Since we’re using Jira and Confluence (another product, sort of a wiki) in the cloud, moving the SCM seems logical.</p>
<h3 id="when-there-is-a-need-there-is-a-will">When there is a need, there is a will<a class="anchor" href="#when-there-is-a-need-there-is-a-will">#</a></h3>
<p>However the migration for Bitbucket from on premises to the cloud is not a trivial matter. As far as I know, <a href="https://confluence.atlassian.com/confeval/other-atlassian-evaluator-resources/migrating-from-server-to-cloud" 
  
   target="_blank" rel="noreferrer noopener" 
>there is no tool from Atlassian</a>
.</p>
<p><img src="/img/1*YTtErALn00hesc_ISWnBHg.jpeg" alt="">Old screenshotThe recommendation for that process is to just import the code. And if you want to do something fancier than moving the code you’re told to <a href="https://community.atlassian.com/t5/Bitbucket-questions/Migrating-from-Stash-to-Bitbucket/qaq-p/57405" 
  
   target="_blank" rel="noreferrer noopener" 
>build a product that uses Bitbucket APIs</a>
.</p>
<p>I’m really surprised about Atlassian not having a tool. And with a considerable number of repositories, even moving the code was not a trivial matter.</p>
<p>So I’m in the process of creating <a href="https://gitremote.site" 
  
   target="_blank" rel="noreferrer noopener" 
>a tool to help migrating git repositories</a>
. The plan is to use it for my company but also at some point to even sell it through the Internet.</p>
<h3 id="bitbucket-api">Bitbucket API<a class="anchor" href="#bitbucket-api">#</a></h3>
<p>But in this post, I just wanted to talk about APIs.</p>
<p>The documentation for the Bitbucket API is <a href="https://developer.atlassian.com/bitbucket/api/2/reference/resource/repositories/%7Busername%7D/%7Brepo_slug%7D/pullrequests" 
  
   target="_blank" rel="noreferrer noopener" 
>reasonably detailed</a>
. However, it seems generated with some kind of tool in a format that I couldn’t understand what was required, what was optional, examples…</p>
<p>To the point I was doing something like this</p>
<p>curl -X POST https://<usr>:<pwd><a href="http://twitter.com/api"  title="Twitter profile for @api" 
  
   target="_blank" rel="noreferrer noopener" 
>@api</a>
.bitbucket.org/2.0/repositories/<namespace>/<project>/pullrequests -d &lsquo;{
&ldquo;title&rdquo;: &ldquo;test&rdquo;,
&ldquo;state&rdquo;: &ldquo;OPEN&rdquo;,
&ldquo;source&rdquo;: {
&ldquo;type&rdquo;: &ldquo;repository&rdquo;,
&ldquo;name&rdquo;: &ldquo;<project>&rdquo;,
&ldquo;full_name&rdquo;: &ldquo;<namespace>/<project>&rdquo;,
&ldquo;scm&rdquo;: &ldquo;git&rdquo;,
&ldquo;branch&rdquo;: {
&ldquo;name&rdquo;: &ldquo;&lt;branch_name&gt;&rdquo;
}
},
&ldquo;is_private&rdquo;: true,
&ldquo;destination&rdquo;: {
&ldquo;type&rdquo;: &ldquo;repository&rdquo;,
&ldquo;name&rdquo;: &ldquo;3pageapp&rdquo;,
&ldquo;full_name&rdquo;: &ldquo;<namespace>/<project>&rdquo;,
&ldquo;scm&rdquo;: &ldquo;git&rdquo;,
&ldquo;branch&rdquo;: {
&ldquo;name&rdquo;: &ldquo;&lt;branch_name&gt;&rdquo;
}
}
}&lsquo;and I was getting the following error</p>
<p>{“type”: “error”, “error”: {“fields”: {“source”: [“This field is required.”], “title”: [“This field is required.”]}, “message”: “Bad request”}}How was it possible? I was sending the source field and the title field, but it was as if it wasn’t being received.</p>
<p>It is very very difficult to debug an API only by invocations. I dedicated a few hours of trying to debug the issue, with different combinations of parameters.</p>
<p>In the end, the issue was much more simpler.</p>
<p>You need to send a header to indicate it is a json request.</p>
<p>curl &lt;&hellip;&gt; -H &ldquo;Content-Type: application/json&quot;Probably others will need less time debugging the issue. IMO Bitbucket should say “you need to send json content-type”.</p>
<p>But in any case, if you arrive from Google, now you know it.</p>


              
          </article>
          

          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="http://gonzalo.f-v.es/tags/developer/">Developer</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="http://gonzalo.f-v.es/blog/2018-07-07-daily-lessons-from-london-trains/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">Daily lessons from London trains</span>
    </a>
  

  
    <a class="pagination__item" href="http://gonzalo.f-v.es/blog/2018-11-18-demophilus-wrote-this/">
      <span class="pagination__label">Next Post</span>
      <span class="pagination__title" >Demophilus wrote this…</span>
    </a>
  
</div>

          
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
      <a class="social-icons__link" rel="me" title="Twitter"
         href="https://twitter.com/gonfva"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://gonzalo.f-v.es/svg/twitter.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="GitHub"
         href="https://github.com/gonfva"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://gonzalo.f-v.es/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="LinkedIn"
         href="https://www.linkedin.com/in/gonzalofernandezvictorio/"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://gonzalo.f-v.es/svg/linkedin.svg')"></div>
      </a>
    
     
</div>

            <p>© Gonzalo Fernandez-Victorio 2021</p>
          </footer>
          </div>
      </div>
      
    </div>


  </main>

   

  
  <script src="/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js" integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr&#43;kQ=" crossorigin="anonymous"></script>
  
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  


</body>

</html>
